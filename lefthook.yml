pre-commit:
  parallel: true
  jobs:
    # TypeScript/JavaScript - una sola ejecución con --write
    - name: biome-code
      glob: "**/*.{ts,tsx,js,jsx}"
      exclude: "node_modules/|.next/|dist/|build/|prisma/migrations/"
      run: pnpm biome check --write --no-errors-on-unmatched {staged_files}
      stage_fixed: true

    # JSON/JSONC - configuraciones sin procesar package locks
    - name: biome-json
      glob: "**/*.{json,jsonc}"
      exclude: "node_modules/|.next/|dist/|build/|pnpm-lock.yaml|package-lock.json"
      run: pnpm biome check --write --no-errors-on-unmatched {staged_files}
      stage_fixed: true

    # Markdown
    - name: biome-markdown
      glob: "**/*.{md,mdx}"
      exclude: "node_modules/|.next/|dist/|CHANGELOG.md"
      run: pnpm biome check --write --no-errors-on-unmatched {staged_files}
      stage_fixed: true

commit-msg:
  jobs:
    - name: commitlint
      run: pnpm commitlint --edit $1

# ============================================================
# PRE-PUSH HOOK: Verificación completa antes de push
# ============================================================
# Ejecuta checks exhaustivos para evitar romper CI/CD
# - TypeScript type checking (tsc --noEmit)
# - Biome linting sin auto-fix (para detectar errores)
# - Prisma schema validation
# 
# Si algún check falla, el push se cancela
# ============================================================
pre-push:
  parallel: false  # Ejecutar en secuencia para mejor output
  jobs:
    - name: typescript-check
      run: pnpm tsc --noEmit --pretty
      
    - name: biome-check
      run: pnpm biome check --no-errors-on-unmatched src/
      
    - name: prisma-validate
      run: pnpm prisma validate
